---
name: spec-gen
description: 生成 Phase 4.5 Spec 规范文档，为复杂模块编写详细的技术规范
allowed-tools: ["Read", "Write", "Edit", "Glob", "Grep"]
---

# spec-gen Skill

生成 Phase 4.5 Spec 规范文档。

## 触发时机

- Phase 4 Architecture 设计方案确定后
- 复杂模块开发前
- COMPLEX 工作流中

## 输入

- Phase 4 的设计方案
- Phase 1 的 Discovery 输出
- Phase 3 的 Clarification 确认结果

## 输出

`.claude/specs/{feature-name}.md`

## Spec 文档结构

```markdown
# {功能名称} 规范文档

## 1. 概述

### 1.1 目标
{功能的核心目标}

### 1.2 范围
{包含的内容}

### 1.3 非目标
{明确不包括的内容}

## 2. 功能需求

### 2.1 用户故事
{As a {角色}, I want {功能}, So that {价值}}

### 2.2 验收标准
- [ ] 标准 1
- [ ] 标准 2
- [ ] 标准 3

### 2.3 边界条件
- 正常情况
- 边缘情况
- 错误情况

## 3. API 设计

### 3.1 公开接口
\`\`\`typescript
// 接口定义
\`\`\`

### 3.2 数据结构
\`\`\`typescript
// 类型定义
\`\`\`

### 3.3 错误处理
| 错误代码 | 描述 | 处理 |
|:---|:---|:---|
| E001 | ... | ... |

## 4. 技术设计

### 4.1 组件架构
\`\`\`
┌─────────────┐
│   Component │
└─────────────┘
\`\`\`

### 4.2 数据流
\`\`\`
Input → Process → Output
\`\`\`

### 4.3 依赖关系
- 内部依赖: ...
- 外部依赖: ...

## 5. 测试策略

### 5.1 单元测试覆盖
- 核心函数: >90%
- 边缘函数: >80%

### 5.2 集成测试场景
1. 场景 1: ...
2. 场景 2: ...

### 5.3 边界测试
- 空输入
- 超长输入
- 并发请求

## 6. 非功能需求

### 6.1 性能要求
- 响应时间: <100ms
- 吞吐量: >1000 req/s

### 6.2 安全要求
- 输入验证
- 权限检查
- 敏感数据保护

### 6.3 可维护性
- 代码注释
- 文档完整
- 日志记录
```

## 生成原则

1. **详细但不冗余**: 提供足够细节，避免模糊描述
2. **可验证**: 验收标准必须可测试
3. **完整性**: 覆盖所有关键方面
4. **可追溯**: 每个需求可追溯到用户故事

## 与其他阶段的关联

- **Phase 1 Discovery**: 提供需求和验收标准
- **Phase 4 Architecture**: 基于设计方案编写
- **Phase 5 TDD Red**: 作为测试编写依据
- **Phase 6 TDD Green**: 作为实现指南

## 质量检查

- [ ] 目标清晰明确
- [ ] 验收标准可测试
- [ ] API 设计完整
- [ ] 技术方案可行
- [ ] 测试策略全面
